// (c) 2019-2020 0b5vr - https://github.com/0b5vr/experimental-npm/blob/master/LICENSE
function t(e,s){if("function"!=typeof s)return t(e,t=>t<s);const n=s;let i=0,r=e.length;for(;i<r;){const t=i+r>>1;n(e[t])?i=t+1:r=t}return i}function e(t,e){const s=t.indexOf(e);return-1!==s&&(t.splice(s,1),!0)}function s(t,e){return-1!==t.indexOf(e)}function n(t,e){return-1===t.indexOf(e)&&(t.push(e),!0)}function i(t,e){const n=[...t];return e.forEach(t=>{s(n,t)||n.push(t)}),n}function r(t,s){const n=[...t];return s.forEach(t=>{e(n,t)}),n}const h=[-1,-1,1,-1,-1,1,1,1],o=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],c=[0,0,1,0,0,1,0,0,1,0,0,1],a=[0,0,1,0,0,1,1,1];function u(t,e){const s=e||(()=>Math.random());for(let e=0;e<t.length-1;e++){const n=e+Math.floor(s()*(t.length-e)),i=t[n];t[n]=t[e],t[e]=i}return t}function _(t){const e=[];for(let s=0;s<t.length/3;s++){const n=3*s;e.push(t[n],t[n+1],t[n+1],t[n+2],t[n+2],t[n])}return e}function l(t,e){const s=[];for(let n=0;n<e;n++)for(let e=0;e<t;e++)s.push(e,n);return s}function m(t,e,s){const n=[];for(let i=0;i<s;i++)for(let s=0;s<e;s++)for(let e=0;e<t;e++)n.push(e,s,i);return n}class f{constructor(){this.factor=100,this.ratio=1,this.velocity=0,this.value=0,this.target=0}update(t){return this.velocity+=(-this.factor*(this.value-this.target)-2*this.velocity*Math.sqrt(this.factor)*this.ratio)*t,this.value+=this.velocity*t,this.value}}class d{constructor(){this.__time=0,this.__deltaTime=0,this.__isPlaying=!1}get time(){return this.__time}get deltaTime(){return this.__deltaTime}get isPlaying(){return this.__isPlaying}update(t){const e=this.__time;this.__time=t||0,this.__deltaTime=this.__time-e}play(){this.__isPlaying=!0}pause(){this.__isPlaying=!1}setTime(t){this.__time=t}}class y extends d{constructor(t=60){super(),this.__frame=0,this.__fps=t}get frame(){return this.__frame}get fps(){return this.__fps}update(){this.__isPlaying?(this.__time=this.__frame/this.__fps,this.__deltaTime=1/this.__fps,this.__frame++):this.__deltaTime=0}setTime(t){this.__frame=Math.floor(this.__fps*t),this.__time=this.__frame/this.__fps}}class p extends d{constructor(){super(...arguments),this.__rtTime=0,this.__rtDate=performance.now()}get isRealtime(){return!0}update(){const t=performance.now();if(this.__isPlaying){const e=this.__time,s=t-this.__rtDate;this.__time=this.__rtTime+s/1e3,this.__deltaTime=this.time-e}else this.__rtTime=this.time,this.__rtDate=t,this.__deltaTime=0}setTime(t){this.__time=t,this.__rtTime=this.time,this.__rtDate=performance.now()}}function x(t,e,s,n){let i=0;const r=new Float32Array(n);r[0]=0;const h=new Float32Array(n+1);h[0]=-1/0,h[1]=1/0;const o=new Float32Array(n);for(let i=0;i<n;i++)o[i]=t[e+i*s];for(let t=1;t<n;t++){let e=0;for(;0<=i&&(e=(o[t]+t*t-o[r[i]]-r[i]*r[i])/(2*t-2*r[i]),e<=h[i]);)i--;i++,r[i]=t,h[i]=e,h[i+1]=1/0}i=0;for(let c=0;c<n;c++){for(;h[i+1]<c;)i++;const n=c-r[i];t[e+c*s]=o[r[i]]+n*n}}function w(t,e,s){for(let n=0;n<e;n++)x(t,n,e,s);for(let n=0;n<s;n++)x(t,n*e,1,e)}function g(t,e,s){return t+(e-t)*s}function M(t,e,s){return Math.min(Math.max(t,e),s)}function z(t){return M(t,0,1)}function T(t,e,s,n,i){return(t-e)*(i-n)/(s-e)+n}function E(t,e,s){return z((s-t)/(e-t))}function v(t,e,s){const n=E(t,e,s);return n*n*(3-2*n)}function $(t,e,s){const n=E(t,e,s);return n*n*n*(n*(6*n-15)+10)}function F(t,e,s){const n=E(t,e,s);return n*n*n*n*(n*(n*(-20*n+70)-84)+35)}class q{constructor(){this.factor=10,this.target=0,this.value=0}update(t){return this.value=g(this.target,this.value,Math.exp(-this.factor*t)),this.value}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function b(t,e,s,n){return new(s||(s=Promise))((function(i,r){function h(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(h,o)}c((n=n.apply(t,e||[])).next())}))}class P{constructor(t){this.index=0,this.array=t}get current(){return this.array[this.index]}next(){return this.index=(this.index+1)%this.array.length,this.current}}class k{constructor(t){this.gl=t;const e=new Array(1024).fill(1).map(()=>t.createQuery());this.queries=new P(e),this.stack=[],this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.__loopTasks=new Set;const s=()=>{this.update(),requestAnimationFrame(s)};s()}static isSupported(t){return new Set(t.getSupportedExtensions()).has("EXT_disjoint_timer_query_webgl2")}update(){Array.from(this.__loopTasks).forEach(t=>t())}measure(t){return b(this,void 0,void 0,(function*(){const{gl:e}=this;if(0!==this.stack.length){e.endQuery(this.ext.TIME_ELAPSED_EXT);const t=this.check(this.queries.current);this.stack=this.stack.map(e=>b(this,void 0,void 0,(function*(){return(yield e)+(yield t)})))}this.stack.push(Promise.resolve(0)),e.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries.next()),t(),e.endQuery(this.ext.TIME_ELAPSED_EXT);const s=this.stack.pop(),n=this.check(this.queries.current);return 0!==this.stack.length&&(this.stack=this.stack.map(t=>b(this,void 0,void 0,(function*(){return(yield t)+(yield n)}))),e.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries.next())),(yield s)+(yield n)}))}check(t){const{gl:e}=this;return new Promise(s=>{const n=()=>{e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)&&(this.__loopTasks.delete(n),s(.001*e.getQueryParameter(t,e.QUERY_RESULT)*.001))};this.__loopTasks.add(n)})}}class A{constructor(t){this.__recalcForEach=0,this.__countUntilRecalc=0,this.__history=[],this.__index=0,this.__count=0,this.__cache=0,this.__length=t,this.__recalcForEach=t;for(let e=0;e<t;e++)this.__history[e]=0}get mean(){const t=Math.min(this.__count,this.__length);return 0===t?0:this.__cache/t}get recalcForEach(){return this.__recalcForEach}set recalcForEach(t){const e=t-this.__recalcForEach;this.__recalcForEach=t,this.__countUntilRecalc=Math.max(0,this.__countUntilRecalc+e)}reset(){this.__index=0,this.__count=0,this.__cache=0,this.__countUntilRecalc=0;for(let t=0;t<this.__length;t++)this.__history[t]=0}push(t){const e=this.__history[this.__index];this.__history[this.__index]=t,this.__count++,this.__index=(this.__index+1)%this.__length,0===this.__countUntilRecalc?this.recalc():(this.__countUntilRecalc--,this.__cache-=e,this.__cache+=t)}recalc(){this.__countUntilRecalc=this.__recalcForEach;const t=this.__history.slice(0,Math.min(this.__count,this.__length)).reduce((t,e)=>t+e,0);this.__cache=t}}class S{constructor(t){this.__history=[],this.__sorted=[],this.__index=0,this.__length=t}get median(){return this.percentile(50)}percentile(t){return 0===this.__history.length?0:this.__sorted[Math.round(.01*t*(this.__history.length-1))]}reset(){this.__index=0,this.__history=[],this.__sorted=[]}push(e){const s=this.__history[this.__index];if(this.__history[this.__index]=e,this.__index=(this.__index+1)%this.__length,this.__sorted.length===this.__length){const e=t(this.__sorted,s);this.__sorted.splice(e,1)}const n=t(this.__sorted,e);this.__sorted.splice(n,0,e)}}class Q extends S{constructor(t){super(t),console.warn("HistoryMedianCalculator: Deprecated. Use HistoryPercentileCalculator instead")}}function R(t){const e=t[0],s=t[1],n=t[2],i=t[3];return[1-2*s*s-2*n*n,2*e*s+2*n*i,2*e*n-2*s*i,0,2*e*s-2*n*i,1-2*e*e-2*n*n,2*s*n+2*e*i,0,2*e*n+2*s*i,2*s*n-2*e*i,1-2*e*e-2*s*s,0,0,0,0,1]}function U(t,e,s){const n=R(e),i=s[0],r=s[1],h=s[2];return[n[0]*i,n[1]*i,n[2]*i,0,n[4]*r,n[5]*r,n[6]*r,0,n[8]*h,n[9]*h,n[10]*h,0,t[0],t[1],t[2],1]}function D(t){const e=t[0],s=t[1],n=t[2],i=t[3],r=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],_=t[10],l=t[11],m=t[12],f=t[13],d=t[14],y=t[15];return(e*h-s*r)*(_*y-l*d)-(e*o-n*r)*(u*y-l*f)+(e*c-i*r)*(u*d-_*f)+(s*o-n*h)*(a*y-l*m)-(s*c-i*h)*(a*d-_*m)+(n*c-i*o)*(a*f-u*m)}function I(t){const e=t[0],s=t[4],n=t[8],i=t[1],r=t[5],h=t[9],o=t[2],c=t[6],a=t[10],u=e+r+a;if(u>0){const t=.5/Math.sqrt(u+1);return[(c-h)*t,(n-o)*t,(i-s)*t,.25/t]}if(e>r&&e>a){const t=2*Math.sqrt(1+e-r-a);return[.25*t,(s+i)/t,(n+o)/t,(c-h)/t]}if(r>a){const t=2*Math.sqrt(1+r-e-a);return[(s+i)/t,.25*t,(h+c)/t,(n-o)/t]}{const t=2*Math.sqrt(1+a-e-r);return[(n+o)/t,(h+c)/t,.25*t,(i-s)/t]}}function L(t){return Math.sqrt(t.reduce((t,e)=>t+e*e,0))}function X(t){let e=L([t[0],t[1],t[2]]);const s=L([t[4],t[5],t[6]]),n=L([t[8],t[9],t[10]]);D(t)<0&&(e=-e);const i=1/e,r=1/s,h=1/n,o=t.concat();return o[0]*=i,o[1]*=i,o[2]*=i,o[4]*=r,o[5]*=r,o[6]*=r,o[8]*=h,o[9]*=h,o[10]*=h,{position:[t[12],t[13],t[14]],scale:[e,s,n],rotation:I(o)}}function B(t,e){return t.map(t=>t*e)}function O(t){const e=t[0],s=t[1],n=t[2],i=t[3],r=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],_=t[10],l=t[11],m=t[12],f=t[13],d=t[14],y=t[15],p=e*h-s*r,x=e*o-n*r,w=e*c-i*r,g=s*o-n*h,M=s*c-i*h,z=n*c-i*o,T=a*f-u*m,E=a*d-_*m,v=a*y-l*m,$=u*d-_*f,F=u*y-l*f,q=_*y-l*d,b=p*q-x*F+w*$+g*v-M*E+z*T;return 0===b?B(t,0):B([h*q-o*F+c*$,n*F-s*q-i*$,f*z-d*M+y*g,_*M-u*z-l*g,o*v-r*q-c*E,e*q-n*v+i*E,d*w-m*z-y*x,a*z-_*w+l*x,r*F-h*v+c*T,s*v-e*F-i*T,m*M-f*w+y*p,u*w-a*M-l*p,h*E-r*$-o*T,e*$-s*E+n*T,f*x-m*g-d*p,a*g-u*x+_*p],1/b)}function V(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Y(...t){if(t.length<2)return t[0];const e=t.shift(),s=Y(...t);return e.map((t,e)=>t+s[e])}function j(t){const e=L(t);return B(t,0===e?0:1/e)}function C(t,e){return t.map((t,s)=>t-e[s])}function H(t,e=[0,0,0],s=[0,1,0],n=0){const i=j(C(t,e));let r=j(V(s,i));0!==n&&(r=Y(B(r,Math.cos(n)),B(V(i,r),Math.sin(n))));const h=V(i,r);return[r[0],r[1],r[2],0,h[0],h[1],h[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],1]}function Z(t,e){return t.reduce((t,s,n)=>t+s*e[n],0)}function G(t,e=[0,0,0],s=[0,1,0],n=0){const i=j(C(t,e));let r=j(V(s,i));0!==n&&(r=Y(B(r,Math.cos(n)),B(V(i,r),Math.sin(n))));const h=V(i,r);return[r[0],h[0],i[0],0,r[1],h[1],i[1],0,r[2],h[2],i[2],0,-Z(r,t),-Z(h,t),-Z(i,t),1]}function J(...t){if(t.length<2)return t[0];const e=t.shift(),s=J(...t),n=e[0],i=e[1],r=e[2],h=e[3],o=e[4],c=e[5],a=e[6],u=e[7],_=e[8],l=e[9],m=e[10],f=e[11],d=e[12],y=e[13],p=e[14],x=e[15],w=s[0],g=s[1],M=s[2],z=s[3],T=s[4],E=s[5],v=s[6],$=s[7],F=s[8],q=s[9],b=s[10],P=s[11],k=s[12],A=s[13],S=s[14],Q=s[15];return[n*w+o*g+_*M+d*z,i*w+c*g+l*M+y*z,r*w+a*g+m*M+p*z,h*w+u*g+f*M+x*z,n*T+o*E+_*v+d*$,i*T+c*E+l*v+y*$,r*T+a*E+m*v+p*$,h*T+u*E+f*v+x*$,n*F+o*q+_*b+d*P,i*F+c*q+l*b+y*P,r*F+a*q+m*b+p*P,h*F+u*q+f*b+x*P,n*k+o*A+_*S+d*Q,i*k+c*A+l*S+y*Q,r*k+a*A+m*S+p*Q,h*k+u*A+f*S+x*Q]}function K(t=45,e=.01,s=100){const n=1/Math.tan(t*Math.PI/360),i=s-e;return[n,0,0,0,0,n,0,0,0,0,-(s+e)/i,-1,0,0,-2*s*e/i,0]}function N(t){const e=Math.cos(t),s=Math.sin(t);return[1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1]}function W(t){const e=Math.cos(t),s=Math.sin(t);return[e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1]}function tt(t){const e=Math.cos(t),s=Math.sin(t);return[e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1]}function et(t){return[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1]}function st(t){return[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1]}function nt(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]}function it(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]}function rt(t,e){const s=e/2,n=Math.sin(s);return[t[0]*n,t[1]*n,t[2]*n,Math.cos(s)]}function ht(t){return[-t[0],-t[1],-t[2],t[3]]}function ot(...t){if(t.length<2)return t[0];const e=t.shift(),s=ot(...t);return[e[3]*s[0]+e[0]*s[3]+e[1]*s[2]-e[2]*s[1],e[3]*s[1]-e[0]*s[2]+e[1]*s[3]+e[2]*s[0],e[3]*s[2]+e[0]*s[1]-e[1]*s[0]+e[2]*s[3],e[3]*s[3]-e[0]*s[0]-e[1]*s[1]-e[2]*s[2]]}function ct(t){const e=L(t);return 0===e?[0,0,0,1]:B(t,1/e)}function at(t,e){return t.map((t,s)=>t/e[s])}function ut(t,e){return t.map((t,s)=>t*e[s])}function _t(t,e){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3]]}function lt(t,e){const s=_t([...t,1],e),n=s.pop();return B(s,1/n)}function mt(t,e){const s=ot(e,[...t,0],ht(e));return s.pop(),s}class ft{get length(){return Math.sqrt(this.elements.reduce((t,e)=>t+e*e,0))}get normalized(){return this.scale(1/this.length)}clone(){return this.__new(this.elements.concat())}add(t){return this.__new(this.elements.map((e,s)=>e+t.elements[s]))}sub(t){return this.__new(this.elements.map((e,s)=>e-t.elements[s]))}multiply(t){return this.__new(this.elements.map((e,s)=>e*t.elements[s]))}divide(t){return this.__new(this.elements.map((e,s)=>e/t.elements[s]))}scale(t){return this.__new(this.elements.map(e=>e*t))}dot(t){return this.elements.reduce((e,s,n)=>e+s*t.elements[n],0)}}class dt extends ft{constructor(t=[0,0,0]){super(),this.elements=t}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}toString(){return`Vector3( ${this.x.toFixed(3)}, ${this.y.toFixed(3)}, ${this.z.toFixed(3)} )`}cross(t){return new dt([this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x])}applyQuaternion(t){const e=new pt([this.x,this.y,this.z,0]),s=t.inversed,n=t.multiply(e).multiply(s);return new dt([n.x,n.y,n.z])}applyMatrix4(t){const e=t.elements,s=1/(e[3]*this.x+e[7]*this.y+e[11]*this.z+e[15]);return new dt([(e[0]*this.x+e[4]*this.y+e[8]*this.z+e[12])*s,(e[1]*this.x+e[5]*this.y+e[9]*this.z+e[13])*s,(e[2]*this.x+e[6]*this.y+e[10]*this.z+e[14])*s])}__new(t){return new dt(t)}static get zero(){return new dt([0,0,0])}static get one(){return new dt([1,1,1])}}const yt=[0,0,0,1];class pt{constructor(t=yt){this.elements=t}get x(){return this.elements[0]}get y(){return this.elements[1]}get z(){return this.elements[2]}get w(){return this.elements[3]}toString(){return`Quaternion( ${this.x.toFixed(3)}, ${this.y.toFixed(3)}, ${this.z.toFixed(3)}, ${this.w.toFixed(3)} )`}clone(){return new pt(this.elements.concat())}get matrix(){const t=new dt([1,0,0]).applyQuaternion(this),e=new dt([0,1,0]).applyQuaternion(this),s=new dt([0,0,1]).applyQuaternion(this);return new wt([t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1])}get inversed(){return new pt([-this.x,-this.y,-this.z,this.w])}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}get normalized(){if(0===this.length)return pt.identity;const t=1/this.length;return new pt([this.x*t,this.y*t,this.z*t,this.w*t])}multiply(t){return new pt([this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z])}static get identity(){return new pt(yt)}static fromAxisAngle(t,e){const s=e/2,n=Math.sin(s);return new pt([t.x*n,t.y*n,t.z*n,Math.cos(s)])}static fromMatrix(t){const e=t.elements,s=e[0],n=e[4],i=e[8],r=e[1],h=e[5],o=e[9],c=e[2],a=e[6],u=e[10],_=s+h+u;if(_>0){const t=.5/Math.sqrt(_+1);return new pt([(a-o)*t,(i-c)*t,(r-n)*t,.25/t])}if(s>h&&s>u){const t=2*Math.sqrt(1+s-h-u);return new pt([.25*t,(n+r)/t,(i+c)/t,(a-o)/t])}if(h>u){const t=2*Math.sqrt(1+h-s-u);return new pt([(n+r)/t,.25*t,(o+a)/t,(i-c)/t])}{const t=2*Math.sqrt(1+u-s-h);return new pt([(i+c)/t,(o+a)/t,.25*t,(r-n)/t])}}}const xt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class wt{constructor(t=xt){this.elements=t}get transpose(){const t=this.elements;return new wt([t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]])}get determinant(){const t=this.elements,e=t[0],s=t[1],n=t[2],i=t[3],r=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],_=t[10],l=t[11],m=t[12],f=t[13],d=t[14],y=t[15];return(e*h-s*r)*(_*y-l*d)-(e*o-n*r)*(u*y-l*f)+(e*c-i*r)*(u*d-_*f)+(s*o-n*h)*(a*y-l*m)-(s*c-i*h)*(a*d-_*m)+(n*c-i*o)*(a*f-u*m)}get inverse(){const t=this.elements,e=t[0],s=t[1],n=t[2],i=t[3],r=t[4],h=t[5],o=t[6],c=t[7],a=t[8],u=t[9],_=t[10],l=t[11],m=t[12],f=t[13],d=t[14],y=t[15],p=e*h-s*r,x=e*o-n*r,w=e*c-i*r,g=s*o-n*h,M=s*c-i*h,z=n*c-i*o,T=a*f-u*m,E=a*d-_*m,v=a*y-l*m,$=u*d-_*f,F=u*y-l*f,q=_*y-l*d,b=p*q-x*F+w*$+g*v-M*E+z*T;if(0===b)return null;const P=1/b;return new wt([h*q-o*F+c*$,n*F-s*q-i*$,f*z-d*M+y*g,_*M-u*z-l*g,o*v-r*q-c*E,e*q-n*v+i*E,d*w-m*z-y*x,a*z-_*w+l*x,r*F-h*v+c*T,s*v-e*F-i*T,m*M-f*w+y*p,u*w-a*M-l*p,h*E-r*$-o*T,e*$-s*E+n*T,f*x-m*g-d*p,a*g-u*x+_*p].map(t=>t*P))}toString(){const t=this.elements.map(t=>t.toFixed(3));return`Matrix4( ${t[0]}, ${t[4]}, ${t[8]}, ${t[12]}; ${t[1]}, ${t[5]}, ${t[9]}, ${t[13]}; ${t[2]}, ${t[6]}, ${t[10]}, ${t[14]}; ${t[3]}, ${t[7]}, ${t[11]}, ${t[15]} )`}clone(){return new wt(this.elements.concat())}multiply(...t){if(0===t.length)return this.clone();const e=t.concat();let s=e.shift();0<e.length&&(s=s.multiply(...e));const n=this.elements,i=s.elements;return new wt([n[0]*i[0]+n[4]*i[1]+n[8]*i[2]+n[12]*i[3],n[1]*i[0]+n[5]*i[1]+n[9]*i[2]+n[13]*i[3],n[2]*i[0]+n[6]*i[1]+n[10]*i[2]+n[14]*i[3],n[3]*i[0]+n[7]*i[1]+n[11]*i[2]+n[15]*i[3],n[0]*i[4]+n[4]*i[5]+n[8]*i[6]+n[12]*i[7],n[1]*i[4]+n[5]*i[5]+n[9]*i[6]+n[13]*i[7],n[2]*i[4]+n[6]*i[5]+n[10]*i[6]+n[14]*i[7],n[3]*i[4]+n[7]*i[5]+n[11]*i[6]+n[15]*i[7],n[0]*i[8]+n[4]*i[9]+n[8]*i[10]+n[12]*i[11],n[1]*i[8]+n[5]*i[9]+n[9]*i[10]+n[13]*i[11],n[2]*i[8]+n[6]*i[9]+n[10]*i[10]+n[14]*i[11],n[3]*i[8]+n[7]*i[9]+n[11]*i[10]+n[15]*i[11],n[0]*i[12]+n[4]*i[13]+n[8]*i[14]+n[12]*i[15],n[1]*i[12]+n[5]*i[13]+n[9]*i[14]+n[13]*i[15],n[2]*i[12]+n[6]*i[13]+n[10]*i[14]+n[14]*i[15],n[3]*i[12]+n[7]*i[13]+n[11]*i[14]+n[15]*i[15]])}scaleScalar(t){return new wt(this.elements.map(e=>e*t))}static get identity(){return new wt(xt)}static multiply(...t){if(0===t.length)return wt.identity;{const e=t.concat();return e.shift().multiply(...e)}}static translate(t){return new wt([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static scale(t){return new wt([t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1])}static scaleScalar(t){return new wt([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}static rotateX(t){return new wt([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1])}static rotateY(t){return new wt([Math.cos(t),0,Math.sin(t),0,0,1,0,0,-Math.sin(t),0,Math.cos(t),0,0,0,0,1])}static rotateZ(t){return new wt([Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1])}static lookAt(t,e=new dt([0,0,0]),s=new dt([0,1,0]),n=0){const i=t.sub(e).normalized;let r=s.cross(i).normalized,h=i.cross(r);return r=r.scale(Math.cos(n)).add(h.scale(Math.sin(n))),h=i.cross(r),new wt([r.x,r.y,r.z,0,h.x,h.y,h.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,1])}static lookAtInverse(t,e=new dt([0,0,0]),s=new dt([0,1,0]),n=0){const i=t.sub(e).normalized;let r=s.cross(i).normalized,h=i.cross(r);return r=r.scale(Math.cos(n)).add(h.scale(Math.sin(n))),h=i.cross(r),new wt([r.x,h.x,i.x,0,r.y,h.y,i.y,0,r.z,h.z,i.z,0,-r.x*t.x-r.y*t.y-r.z*t.z,-h.x*t.x-h.y*t.y-h.z*t.z,-i.x*t.x-i.y*t.y-i.z*t.z,1])}static perspective(t=45,e=.01,s=100){const n=1/Math.tan(t*Math.PI/360),i=s-e;return new wt([n,0,0,0,0,n,0,0,0,0,-(s+e)/i,-1,0,0,-2*s*e/i,0])}decompose(){const t=this.elements;let e=new dt([t[0],t[1],t[2]]).length;const s=new dt([t[4],t[5],t[6]]).length,n=new dt([t[8],t[9],t[10]]).length;this.determinant<0&&(e=-e);const i=1/e,r=1/s,h=1/n,o=this.clone();return o.elements[0]*=i,o.elements[1]*=i,o.elements[2]*=i,o.elements[4]*=r,o.elements[5]*=r,o.elements[6]*=r,o.elements[8]*=h,o.elements[9]*=h,o.elements[10]*=h,{position:new dt([t[12],t[13],t[14]]),scale:new dt([e,s,n]),rotation:pt.fromMatrix(o)}}static compose(t,e,s){const n=e.x,i=e.y,r=e.z,h=e.w,o=n+n,c=i+i,a=r+r,u=n*o,_=n*c,l=n*a,m=i*c,f=i*a,d=r*a,y=h*o,p=h*c,x=h*a,w=s.x,g=s.y,M=s.z;return new wt([(1-(m+d))*w,(_+x)*w,(l-p)*w,0,(_-x)*g,(1-(u+d))*g,(f+y)*g,0,(l+p)*M,(f-y)*M,(1-(u+m))*M,0,t.x,t.y,t.z,1])}}function gt(t,e){return t-Math.floor(t/e)*e}class Mt extends ft{constructor(t=[0,0,0,0]){super(),this.elements=t}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}get w(){return this.elements[3]}set w(t){this.elements[3]=t}toString(){return`Vector4( ${this.x.toFixed(3)}, ${this.y.toFixed(3)}, ${this.z.toFixed(3)}, ${this.w.toFixed(3)} )`}applyMatrix4(t){const e=t.elements;return new Mt([e[0]*this.x+e[4]*this.y+e[8]*this.z+e[12]*this.w,e[1]*this.x+e[5]*this.y+e[9]*this.z+e[13]*this.w,e[2]*this.x+e[6]*this.y+e[10]*this.z+e[14]*this.w,e[3]*this.x+e[7]*this.y+e[11]*this.z+e[15]*this.w])}__new(t){return new Mt(t)}static get zero(){return new Mt([0,0,0,0])}static get one(){return new Mt([1,1,1,1])}}class zt{constructor(t,e){this.i=t,this.o=e}swap(){const t=this.i;this.i=this.o,this.o=t}}class Tt{constructor(){this.__bpm=0,this.__lastTap=0,this.__lastBeat=0,this.__lastTime=0,this.__calc=new A(16)}get beatDuration(){return 60/this.__bpm}get bpm(){return this.__bpm}set bpm(t){this.__lastBeat=this.beat,this.__lastTime=performance.now(),this.__bpm=t}get beat(){return this.__lastBeat+.001*(performance.now()-this.__lastTime)/this.beatDuration}reset(){this.__calc.reset()}nudge(t){this.__lastBeat=this.beat+t,this.__lastTime=performance.now()}tap(){const t=performance.now(),e=.001*(t-this.__lastTap);2<e?this.reset():(this.__calc.push(e),this.__bpm=60/this.__calc.mean),this.__lastTap=t,this.__lastTime=t,this.__lastBeat=0}}class Et{constructor(t){this.seed=t||1}gen(t){return t&&(this.seed=t),this.seed=this.seed^this.seed<<13,this.seed=this.seed^this.seed>>>17,this.seed=this.seed^this.seed<<5,this.seed/Math.pow(2,32)+.5}set(t){this.seed=t||this.seed||1}}export{f as CDS,d as Clock,y as ClockFrame,p as ClockRealtime,q as ExpSmooth,k as GPUTimer,A as HistoryMeanCalculator,Q as HistoryMedianCalculator,S as HistoryPercentileCalculator,wt as Matrix4,P as Pool,pt as Quaternion,zt as Swap,h as TRIANGLE_STRIP_QUAD,o as TRIANGLE_STRIP_QUAD_3D,c as TRIANGLE_STRIP_QUAD_NORMAL,a as TRIANGLE_STRIP_QUAD_UV,Tt as TapTempo,ft as Vector,dt as Vector3,Mt as Vector4,Et as Xorshift,n as arraySetAdd,e as arraySetDelete,r as arraySetDiff,s as arraySetHas,i as arraySetUnion,t as binarySearch,M as clamp,x as edt1d,w as edt2d,g as lerp,E as linearstep,U as mat4Compose,X as mat4Decompose,D as mat4Determinant,R as mat4FromQuaternion,O as mat4Inverse,H as mat4LookAt,G as mat4LookAtInverse,J as mat4Multiply,K as mat4Perspective,N as mat4RotateX,W as mat4RotateY,tt as mat4RotateZ,et as mat4Scale,st as mat4ScaleScalar,nt as mat4Translate,it as mat4Transpose,l as matrix2d,m as matrix3d,gt as mod,rt as quatFromAxisAngle,I as quatFromMatrix4,ht as quatInverse,ot as quatMultiply,ct as quatNormalize,T as range,xt as rawIdentityMatrix4,yt as rawIdentityQuaternion,z as saturate,u as shuffleArray,$ as smootherstep,F as smootheststep,v as smoothstep,_ as triIndexToLineIndex,lt as vec3ApplyMatrix4,mt as vec3ApplyQuaternion,V as vec3Cross,_t as vec4ApplyMatrix4,Y as vecAdd,at as vecDivide,Z as vecDot,L as vecLength,ut as vecMultiply,j as vecNormalize,B as vecScale,C as vecSub};
