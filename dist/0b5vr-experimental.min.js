// (c) 2019-2020 0b5vr - https://github.com/0b5vr/experimental-npm/blob/master/LICENSE
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).OBSVR_EXPERIMENTAL={})}(this,(function(t){"use strict";function e(t,n){if("function"!=typeof n)return e(t,(function(t){return t<n}));for(var r=n,i=0,o=t.length;i<o;){var s=i+o>>1;r(t[s])?i=s+1:o=s}return i}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function u(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}function a(t,e){var n=t.indexOf(e);return-1!==n&&(t.splice(n,1),!0)}function c(t,e){return-1!==t.indexOf(e)}var h=function(){function t(){this.factor=100,this.ratio=1,this.velocity=0,this.value=0,this.target=0}return t.prototype.update=function(t){return this.velocity+=(-this.factor*(this.value-this.target)-2*this.velocity*Math.sqrt(this.factor)*this.ratio)*t,this.value+=this.velocity*t,this.value},t}(),f=function(){function t(){this.__time=0,this.__deltaTime=0,this.__isPlaying=!1}return Object.defineProperty(t.prototype,"time",{get:function(){return this.__time},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this.__deltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this.__isPlaying},enumerable:!1,configurable:!0}),t.prototype.update=function(t){var e=this.__time;this.__time=t||0,this.__deltaTime=this.__time-e},t.prototype.play=function(){this.__isPlaying=!0},t.prototype.pause=function(){this.__isPlaying=!1},t.prototype.setTime=function(t){this.__time=t},t}(),l=function(t){function e(e){void 0===e&&(e=60);var n=t.call(this)||this;return n.__frame=0,n.__fps=e,n}return r(e,t),Object.defineProperty(e.prototype,"frame",{get:function(){return this.__frame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fps",{get:function(){return this.__fps},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.__isPlaying?(this.__time=this.__frame/this.__fps,this.__deltaTime=1/this.__fps,this.__frame++):this.__deltaTime=0},e.prototype.setTime=function(t){this.__frame=Math.floor(this.__fps*t),this.__time=this.__frame/this.__fps},e}(f),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.__rtTime=0,e.__rtDate=performance.now(),e}return r(e,t),Object.defineProperty(e.prototype,"isRealtime",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.update=function(){var t=performance.now();if(this.__isPlaying){var e=this.__time,n=t-this.__rtDate;this.__time=this.__rtTime+n/1e3,this.__deltaTime=this.time-e}else this.__rtTime=this.time,this.__rtDate=t,this.__deltaTime=0},e.prototype.setTime=function(t){this.__time=t,this.__rtTime=this.time,this.__rtDate=performance.now()},e}(f);function _(t,e,n,r){var i=0,o=new Float32Array(r);o[0]=0;var s=new Float32Array(r+1);s[0]=-1/0,s[1]=1/0;for(var u=new Float32Array(r),a=0;a<r;a++)u[a]=t[e+a*n];for(a=1;a<r;a++){for(var c=0;0<=i&&(c=(u[a]+a*a-u[o[i]]-o[i]*o[i])/(2*a-2*o[i]))<=s[i];)i--;o[++i]=a,s[i]=c,s[i+1]=1/0}i=0;for(a=0;a<r;a++){for(;s[i+1]<a;)i++;var h=a-o[i];t[e+a*n]=u[o[i]]+h*h}}function y(t,e,n){return t+(e-t)*n}function m(t,e,n){return Math.min(Math.max(t,e),n)}function d(t){return m(t,0,1)}function v(t,e,n){return d((n-t)/(e-t))}var b=function(){function t(){this.factor=10,this.target=0,this.value=0}return t.prototype.update=function(t){return this.value=y(this.target,this.value,Math.exp(-this.factor*t)),this.value},t}(),g=function(){function t(t){this.index=0,this.array=t}return Object.defineProperty(t.prototype,"current",{get:function(){return this.array[this.index]},enumerable:!1,configurable:!0}),t.prototype.next=function(){return this.index=(this.index+1)%this.array.length,this.current},t}(),x=function(){function t(t){var e=this;this.gl=t;var n=new Array(1024).fill(1).map((function(){return t.createQuery()}));this.queries=new g(n),this.stack=[],this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.__loopTasks=new Set;var r=function(){e.update(),requestAnimationFrame(r)};r()}return t.isSupported=function(t){return new Set(t.getSupportedExtensions()).has("EXT_disjoint_timer_query_webgl2")},t.prototype.update=function(){Array.from(this.__loopTasks).forEach((function(t){return t()}))},t.prototype.measure=function(t){return i(this,void 0,void 0,(function(){var e,n,r,s,u,a=this;return o(this,(function(c){switch(c.label){case 0:return e=this.gl,0!==this.stack.length&&(e.endQuery(this.ext.TIME_ELAPSED_EXT),n=this.check(this.queries.current),this.stack=this.stack.map((function(t){return i(a,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return[4,t];case 1:return e=r.sent(),[4,n];case 2:return[2,e+r.sent()]}}))}))}))),this.stack.push(Promise.resolve(0)),e.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries.next()),t(),e.endQuery(this.ext.TIME_ELAPSED_EXT),r=this.stack.pop(),s=this.check(this.queries.current),0!==this.stack.length&&(this.stack=this.stack.map((function(t){return i(a,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,t];case 1:return e=n.sent(),[4,s];case 2:return[2,e+n.sent()]}}))}))})),e.beginQuery(this.ext.TIME_ELAPSED_EXT,this.queries.next())),[4,r];case 1:return u=c.sent(),[4,s];case 2:return[2,u+c.sent()]}}))}))},t.prototype.check=function(t){var e=this,n=this.gl;return new Promise((function(r){var i=function(){n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE)&&(e.__loopTasks.delete(i),r(.001*n.getQueryParameter(t,n.QUERY_RESULT)*.001))};e.__loopTasks.add(i)}))},t}(),w=function(){function t(t){this.__recalcForEach=0,this.__countUntilRecalc=0,this.__history=[],this.__index=0,this.__count=0,this.__cache=0,this.__length=t,this.__recalcForEach=t;for(var e=0;e<t;e++)this.__history[e]=0}return Object.defineProperty(t.prototype,"mean",{get:function(){var t=Math.min(this.__count,this.__length);return 0===t?0:this.__cache/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"recalcForEach",{get:function(){return this.__recalcForEach},set:function(t){var e=t-this.__recalcForEach;this.__recalcForEach=t,this.__countUntilRecalc=Math.max(0,this.__countUntilRecalc+e)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.__index=0,this.__count=0,this.__cache=0,this.__countUntilRecalc=0;for(var t=0;t<this.__length;t++)this.__history[t]=0},t.prototype.push=function(t){var e=this.__history[this.__index];this.__history[this.__index]=t,this.__count++,this.__index=(this.__index+1)%this.__length,0===this.__countUntilRecalc?this.recalc():(this.__countUntilRecalc--,this.__cache-=e,this.__cache+=t)},t.prototype.recalc=function(){this.__countUntilRecalc=this.__recalcForEach;var t=this.__history.slice(0,Math.min(this.__count,this.__length)).reduce((function(t,e){return t+e}),0);this.__cache=t},t}(),M=function(){function t(t){this.__history=[],this.__sorted=[],this.__index=0,this.__length=t}return Object.defineProperty(t.prototype,"median",{get:function(){return this.percentile(50)},enumerable:!1,configurable:!0}),t.prototype.percentile=function(t){return 0===this.__history.length?0:this.__sorted[Math.round(.01*t*(this.__history.length-1))]},t.prototype.reset=function(){this.__index=0,this.__history=[],this.__sorted=[]},t.prototype.push=function(t){var n=this.__history[this.__index];if(this.__history[this.__index]=t,this.__index=(this.__index+1)%this.__length,this.__sorted.length===this.__length){var r=e(this.__sorted,n);this.__sorted.splice(r,1)}var i=e(this.__sorted,t);this.__sorted.splice(i,0,t)},t}(),P=function(t){function e(e){var n=t.call(this,e)||this;return console.warn("HistoryMedianCalculator: Deprecated. Use HistoryPercentileCalculator instead"),n}return r(e,t),e}(M);function z(t){var e=t[0],n=t[1],r=t[2],i=t[3];return[1-2*n*n-2*r*r,2*e*n+2*r*i,2*e*r-2*n*i,0,2*e*n-2*r*i,1-2*e*e-2*r*r,2*n*r+2*e*i,0,2*e*r+2*n*i,2*n*r-2*e*i,1-2*e*e-2*n*n,0,0,0,0,1]}function T(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],u=t[6],a=t[7],c=t[8],h=t[9],f=t[10],l=t[11],p=t[12],_=t[13],y=t[14],m=t[15];return(e*s-n*o)*(f*m-l*y)-(e*u-r*o)*(h*m-l*_)+(e*a-i*o)*(h*y-f*_)+(n*u-r*s)*(c*m-l*p)-(n*a-i*s)*(c*y-f*p)+(r*a-i*u)*(c*_-h*p)}function O(t){var e,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],u=t[9],a=t[2],c=t[6],h=t[10],f=n+s+h;return f>0?[(c-u)*(e=.5/Math.sqrt(f+1)),(i-a)*e,(o-r)*e,.25/e]:n>s&&n>h?[.25*(e=2*Math.sqrt(1+n-s-h)),(r+o)/e,(i+a)/e,(c-u)/e]:s>h?[(r+o)/(e=2*Math.sqrt(1+s-n-h)),.25*e,(u+c)/e,(i-a)/e]:[(i+a)/(e=2*Math.sqrt(1+h-n-s)),(u+c)/e,.25*e,(o-r)/e]}function j(t){return Math.sqrt(t.reduce((function(t,e){return t+e*e}),0))}function E(t,e){return t.map((function(t){return t*e}))}function S(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function A(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length<2)return t[0];var n=t.shift(),r=A.apply(void 0,u([],s(t)));return n.map((function(t,e){return t+r[e]}))}function k(t){var e=j(t);return E(t,0===e?0:1/e)}function F(t,e){return t.map((function(t,n){return t-e[n]}))}function R(t,e){return t.reduce((function(t,n,r){return t+n*e[r]}),0)}function q(t){return[-t[0],-t[1],-t[2],t[3]]}function I(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length<2)return t[0];var n=t.shift(),r=I.apply(void 0,u([],s(t)));return[n[3]*r[0]+n[0]*r[3]+n[1]*r[2]-n[2]*r[1],n[3]*r[1]-n[0]*r[2]+n[1]*r[3]+n[2]*r[0],n[3]*r[2]+n[0]*r[1]-n[1]*r[0]+n[2]*r[3],n[3]*r[3]-n[0]*r[0]-n[1]*r[1]-n[2]*r[2]]}function D(t,e){return[e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3]]}var Q=function(){function t(){}return Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.elements.reduce((function(t,e){return t+e*e}),0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalized",{get:function(){return this.scale(1/this.length)},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return this.__new(this.elements.concat())},t.prototype.add=function(t){return this.__new(this.elements.map((function(e,n){return e+t.elements[n]})))},t.prototype.sub=function(t){return this.__new(this.elements.map((function(e,n){return e-t.elements[n]})))},t.prototype.multiply=function(t){return this.__new(this.elements.map((function(e,n){return e*t.elements[n]})))},t.prototype.divide=function(t){return this.__new(this.elements.map((function(e,n){return e/t.elements[n]})))},t.prototype.scale=function(t){return this.__new(this.elements.map((function(e){return e*t})))},t.prototype.dot=function(t){return this.elements.reduce((function(e,n,r){return e+n*t.elements[r]}),0)},t}(),U=function(t){function e(e){void 0===e&&(e=[0,0,0]);var n=t.call(this)||this;return n.elements=e,n}return r(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.elements[0]},set:function(t){this.elements[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.elements[1]},set:function(t){this.elements[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.elements[2]},set:function(t){this.elements[2]=t},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"Vector3( "+this.x.toFixed(3)+", "+this.y.toFixed(3)+", "+this.z.toFixed(3)+" )"},e.prototype.cross=function(t){return new e([this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x])},e.prototype.applyQuaternion=function(t){var n=new C([this.x,this.y,this.z,0]),r=t.inversed,i=t.multiply(n).multiply(r);return new e([i.x,i.y,i.z])},e.prototype.applyMatrix4=function(t){var n=t.elements,r=1/(n[3]*this.x+n[7]*this.y+n[11]*this.z+n[15]);return new e([(n[0]*this.x+n[4]*this.y+n[8]*this.z+n[12])*r,(n[1]*this.x+n[5]*this.y+n[9]*this.z+n[13])*r,(n[2]*this.x+n[6]*this.y+n[10]*this.z+n[14])*r])},e.prototype.__new=function(t){return new e(t)},Object.defineProperty(e,"zero",{get:function(){return new e([0,0,0])},enumerable:!1,configurable:!0}),Object.defineProperty(e,"one",{get:function(){return new e([1,1,1])},enumerable:!1,configurable:!0}),e}(Q),L=[0,0,0,1],C=function(){function t(t){void 0===t&&(t=L),this.elements=t}return Object.defineProperty(t.prototype,"x",{get:function(){return this.elements[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.elements[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.elements[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.elements[3]},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"Quaternion( "+this.x.toFixed(3)+", "+this.y.toFixed(3)+", "+this.z.toFixed(3)+", "+this.w.toFixed(3)+" )"},t.prototype.clone=function(){return new t(this.elements.concat())},Object.defineProperty(t.prototype,"matrix",{get:function(){var t=new U([1,0,0]).applyQuaternion(this),e=new U([0,1,0]).applyQuaternion(this),n=new U([0,0,1]).applyQuaternion(this);return new N([t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inversed",{get:function(){return new t([-this.x,-this.y,-this.z,this.w])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalized",{get:function(){if(0===this.length)return t.identity;var e=1/this.length;return new t([this.x*e,this.y*e,this.z*e,this.w*e])},enumerable:!1,configurable:!0}),t.prototype.multiply=function(e){return new t([this.w*e.x+this.x*e.w+this.y*e.z-this.z*e.y,this.w*e.y-this.x*e.z+this.y*e.w+this.z*e.x,this.w*e.z+this.x*e.y-this.y*e.x+this.z*e.w,this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z])},Object.defineProperty(t,"identity",{get:function(){return new t(L)},enumerable:!1,configurable:!0}),t.fromAxisAngle=function(e,n){var r=n/2,i=Math.sin(r);return new t([e.x*i,e.y*i,e.z*i,Math.cos(r)])},t.fromMatrix=function(e){var n,r=e.elements,i=r[0],o=r[4],s=r[8],u=r[1],a=r[5],c=r[9],h=r[2],f=r[6],l=r[10],p=i+a+l;return new t(p>0?[(f-c)*(n=.5/Math.sqrt(p+1)),(s-h)*n,(u-o)*n,.25/n]:i>a&&i>l?[.25*(n=2*Math.sqrt(1+i-a-l)),(o+u)/n,(s+h)/n,(f-c)/n]:a>l?[(o+u)/(n=2*Math.sqrt(1+a-i-l)),.25*n,(c+f)/n,(s-h)/n]:[(s+h)/(n=2*Math.sqrt(1+l-i-a)),(c+f)/n,.25*n,(u-o)/n])},t}(),X=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],N=function(){function t(t){void 0===t&&(t=X),this.elements=t}return Object.defineProperty(t.prototype,"transpose",{get:function(){var e=this.elements;return new t([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"determinant",{get:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],u=t[6],a=t[7],c=t[8],h=t[9],f=t[10],l=t[11],p=t[12],_=t[13],y=t[14],m=t[15];return(e*s-n*o)*(f*m-l*y)-(e*u-r*o)*(h*m-l*_)+(e*a-i*o)*(h*y-f*_)+(n*u-r*s)*(c*m-l*p)-(n*a-i*s)*(c*y-f*p)+(r*a-i*u)*(c*_-h*p)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inverse",{get:function(){var e=this.elements,n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],u=e[5],a=e[6],c=e[7],h=e[8],f=e[9],l=e[10],p=e[11],_=e[12],y=e[13],m=e[14],d=e[15],v=n*u-r*s,b=n*a-i*s,g=n*c-o*s,x=r*a-i*u,w=r*c-o*u,M=i*c-o*a,P=h*y-f*_,z=h*m-l*_,T=h*d-p*_,O=f*m-l*y,j=f*d-p*y,E=l*d-p*m,S=v*E-b*j+g*O+x*T-w*z+M*P;if(0===S)return null;var A=1/S;return new t([u*E-a*j+c*O,i*j-r*E-o*O,y*M-m*w+d*x,l*w-f*M-p*x,a*T-s*E-c*z,n*E-i*T+o*z,m*g-_*M-d*b,h*M-l*g+p*b,s*j-u*T+c*P,r*T-n*j-o*P,_*w-y*g+d*v,f*g-h*w-p*v,u*z-s*O-a*P,n*O-r*z+i*P,y*b-_*x-m*v,h*x-f*b+l*v].map((function(t){return t*A})))},enumerable:!1,configurable:!0}),t.prototype.toString=function(){var t=this.elements.map((function(t){return t.toFixed(3)}));return"Matrix4( "+t[0]+", "+t[4]+", "+t[8]+", "+t[12]+"; "+t[1]+", "+t[5]+", "+t[9]+", "+t[13]+"; "+t[2]+", "+t[6]+", "+t[10]+", "+t[14]+"; "+t[3]+", "+t[7]+", "+t[11]+", "+t[15]+" )"},t.prototype.clone=function(){return new t(this.elements.concat())},t.prototype.multiply=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)return this.clone();var r=e.concat(),i=r.shift();0<r.length&&(i=i.multiply.apply(i,u([],s(r))));var o=this.elements,a=i.elements;return new t([o[0]*a[0]+o[4]*a[1]+o[8]*a[2]+o[12]*a[3],o[1]*a[0]+o[5]*a[1]+o[9]*a[2]+o[13]*a[3],o[2]*a[0]+o[6]*a[1]+o[10]*a[2]+o[14]*a[3],o[3]*a[0]+o[7]*a[1]+o[11]*a[2]+o[15]*a[3],o[0]*a[4]+o[4]*a[5]+o[8]*a[6]+o[12]*a[7],o[1]*a[4]+o[5]*a[5]+o[9]*a[6]+o[13]*a[7],o[2]*a[4]+o[6]*a[5]+o[10]*a[6]+o[14]*a[7],o[3]*a[4]+o[7]*a[5]+o[11]*a[6]+o[15]*a[7],o[0]*a[8]+o[4]*a[9]+o[8]*a[10]+o[12]*a[11],o[1]*a[8]+o[5]*a[9]+o[9]*a[10]+o[13]*a[11],o[2]*a[8]+o[6]*a[9]+o[10]*a[10]+o[14]*a[11],o[3]*a[8]+o[7]*a[9]+o[11]*a[10]+o[15]*a[11],o[0]*a[12]+o[4]*a[13]+o[8]*a[14]+o[12]*a[15],o[1]*a[12]+o[5]*a[13]+o[9]*a[14]+o[13]*a[15],o[2]*a[12]+o[6]*a[13]+o[10]*a[14]+o[14]*a[15],o[3]*a[12]+o[7]*a[13]+o[11]*a[14]+o[15]*a[15]])},t.prototype.scaleScalar=function(e){return new t(this.elements.map((function(t){return t*e})))},Object.defineProperty(t,"identity",{get:function(){return new t(X)},enumerable:!1,configurable:!0}),t.multiply=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)return t.identity;var r=e.concat(),i=r.shift();return i.multiply.apply(i,u([],s(r)))},t.translate=function(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1])},t.scale=function(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1])},t.scaleScalar=function(e){return new t([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])},t.rotateX=function(e){return new t([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1])},t.rotateY=function(e){return new t([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1])},t.rotateZ=function(e){return new t([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1])},t.lookAt=function(e,n,r,i){void 0===n&&(n=new U([0,0,0])),void 0===r&&(r=new U([0,1,0])),void 0===i&&(i=0);var o=e.sub(n).normalized,s=r.cross(o).normalized,u=o.cross(s);return s=s.scale(Math.cos(i)).add(u.scale(Math.sin(i))),u=o.cross(s),new t([s.x,s.y,s.z,0,u.x,u.y,u.z,0,o.x,o.y,o.z,0,e.x,e.y,e.z,1])},t.lookAtInverse=function(e,n,r,i){void 0===n&&(n=new U([0,0,0])),void 0===r&&(r=new U([0,1,0])),void 0===i&&(i=0);var o=e.sub(n).normalized,s=r.cross(o).normalized,u=o.cross(s);return s=s.scale(Math.cos(i)).add(u.scale(Math.sin(i))),u=o.cross(s),new t([s.x,u.x,o.x,0,s.y,u.y,o.y,0,s.z,u.z,o.z,0,-s.x*e.x-s.y*e.y-s.z*e.z,-u.x*e.x-u.y*e.y-u.z*e.z,-o.x*e.x-o.y*e.y-o.z*e.z,1])},t.perspective=function(e,n,r){void 0===e&&(e=45),void 0===n&&(n=.01),void 0===r&&(r=100);var i=1/Math.tan(e*Math.PI/360),o=r-n;return new t([i,0,0,0,0,i,0,0,0,0,-(r+n)/o,-1,0,0,-2*r*n/o,0])},t.prototype.decompose=function(){var t=this.elements,e=new U([t[0],t[1],t[2]]).length,n=new U([t[4],t[5],t[6]]).length,r=new U([t[8],t[9],t[10]]).length;this.determinant<0&&(e=-e);var i=1/e,o=1/n,s=1/r,u=this.clone();return u.elements[0]*=i,u.elements[1]*=i,u.elements[2]*=i,u.elements[4]*=o,u.elements[5]*=o,u.elements[6]*=o,u.elements[8]*=s,u.elements[9]*=s,u.elements[10]*=s,{position:new U([t[12],t[13],t[14]]),scale:new U([e,n,r]),rotation:C.fromMatrix(u)}},t.compose=function(e,n,r){var i=n.x,o=n.y,s=n.z,u=n.w,a=i+i,c=o+o,h=s+s,f=i*a,l=i*c,p=i*h,_=o*c,y=o*h,m=s*h,d=u*a,v=u*c,b=u*h,g=r.x,x=r.y,w=r.z;return new t([(1-(_+m))*g,(l+b)*g,(p-v)*g,0,(l-b)*x,(1-(f+m))*x,(y+d)*x,0,(p+v)*w,(y-d)*w,(1-(f+_))*w,0,e.x,e.y,e.z,1])},t}();var V=function(t){function e(e){void 0===e&&(e=[0,0,0,0]);var n=t.call(this)||this;return n.elements=e,n}return r(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.elements[0]},set:function(t){this.elements[0]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.elements[1]},set:function(t){this.elements[1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.elements[2]},set:function(t){this.elements[2]=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this.elements[3]},set:function(t){this.elements[3]=t},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"Vector4( "+this.x.toFixed(3)+", "+this.y.toFixed(3)+", "+this.z.toFixed(3)+", "+this.w.toFixed(3)+" )"},e.prototype.applyMatrix4=function(t){var n=t.elements;return new e([n[0]*this.x+n[4]*this.y+n[8]*this.z+n[12]*this.w,n[1]*this.x+n[5]*this.y+n[9]*this.z+n[13]*this.w,n[2]*this.x+n[6]*this.y+n[10]*this.z+n[14]*this.w,n[3]*this.x+n[7]*this.y+n[11]*this.z+n[15]*this.w])},e.prototype.__new=function(t){return new e(t)},Object.defineProperty(e,"zero",{get:function(){return new e([0,0,0,0])},enumerable:!1,configurable:!0}),Object.defineProperty(e,"one",{get:function(){return new e([1,1,1,1])},enumerable:!1,configurable:!0}),e}(Q),B=function(){function t(t,e){this.i=t,this.o=e}return t.prototype.swap=function(){var t=this.i;this.i=this.o,this.o=t},t}(),G=function(){function t(){this.__bpm=0,this.__lastTap=0,this.__lastBeat=0,this.__lastTime=0,this.__calc=new w(16)}return Object.defineProperty(t.prototype,"beatDuration",{get:function(){return 60/this.__bpm},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bpm",{get:function(){return this.__bpm},set:function(t){this.__lastBeat=this.beat,this.__lastTime=performance.now(),this.__bpm=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beat",{get:function(){return this.__lastBeat+.001*(performance.now()-this.__lastTime)/this.beatDuration},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.__calc.reset()},t.prototype.nudge=function(t){this.__lastBeat=this.beat+t,this.__lastTime=performance.now()},t.prototype.tap=function(){var t=performance.now(),e=.001*(t-this.__lastTap);2<e?this.reset():(this.__calc.push(e),this.__bpm=60/this.__calc.mean),this.__lastTap=t,this.__lastTime=t,this.__lastBeat=0},t}(),H=function(){function t(t){this.seed=t||1}return t.prototype.gen=function(t){return t&&(this.seed=t),this.seed=this.seed^this.seed<<13,this.seed=this.seed^this.seed>>>17,this.seed=this.seed^this.seed<<5,this.seed/Math.pow(2,32)+.5},t.prototype.set=function(t){this.seed=t||this.seed||1},t}();t.CDS=h,t.Clock=f,t.ClockFrame=l,t.ClockRealtime=p,t.ExpSmooth=b,t.GPUTimer=x,t.HistoryMeanCalculator=w,t.HistoryMedianCalculator=P,t.HistoryPercentileCalculator=M,t.Matrix4=N,t.Pool=g,t.Quaternion=C,t.Swap=B,t.TRIANGLE_STRIP_QUAD=[-1,-1,1,-1,-1,1,1,1],t.TRIANGLE_STRIP_QUAD_3D=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],t.TRIANGLE_STRIP_QUAD_NORMAL=[0,0,1,0,0,1,0,0,1,0,0,1],t.TRIANGLE_STRIP_QUAD_UV=[0,0,1,0,0,1,1,1],t.TapTempo=G,t.Vector=Q,t.Vector3=U,t.Vector4=V,t.Xorshift=H,t.arraySetAdd=function(t,e){return-1===t.indexOf(e)&&(t.push(e),!0)},t.arraySetDelete=a,t.arraySetDiff=function(t,e){var n=u([],s(t));return e.forEach((function(t){a(n,t)})),n},t.arraySetHas=c,t.arraySetUnion=function(t,e){var n=u([],s(t));return e.forEach((function(t){c(n,t)||n.push(t)})),n},t.binarySearch=e,t.clamp=m,t.edt1d=_,t.edt2d=function(t,e,n){for(var r=0;r<e;r++)_(t,r,e,n);for(var i=0;i<n;i++)_(t,i*e,1,e)},t.lerp=y,t.linearstep=v,t.mat4Compose=function(t,e,n){var r=z(e),i=n[0],o=n[1],s=n[2];return[r[0]*i,r[1]*i,r[2]*i,0,r[4]*o,r[5]*o,r[6]*o,0,r[8]*s,r[9]*s,r[10]*s,0,t[0],t[1],t[2],1]},t.mat4Decompose=function(t){var e=j([t[0],t[1],t[2]]),n=j([t[4],t[5],t[6]]),r=j([t[8],t[9],t[10]]);T(t)<0&&(e=-e);var i=1/e,o=1/n,s=1/r,u=t.concat();return u[0]*=i,u[1]*=i,u[2]*=i,u[4]*=o,u[5]*=o,u[6]*=o,u[8]*=s,u[9]*=s,u[10]*=s,{position:[t[12],t[13],t[14]],scale:[e,n,r],rotation:O(u)}},t.mat4Determinant=T,t.mat4FromQuaternion=z,t.mat4Inverse=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],u=t[6],a=t[7],c=t[8],h=t[9],f=t[10],l=t[11],p=t[12],_=t[13],y=t[14],m=t[15],d=e*s-n*o,v=e*u-r*o,b=e*a-i*o,g=n*u-r*s,x=n*a-i*s,w=r*a-i*u,M=c*_-h*p,P=c*y-f*p,z=c*m-l*p,T=h*y-f*_,O=h*m-l*_,j=f*m-l*y,S=d*j-v*O+b*T+g*z-x*P+w*M;return 0===S?E(t,0):E([s*j-u*O+a*T,r*O-n*j-i*T,_*w-y*x+m*g,f*x-h*w-l*g,u*z-o*j-a*P,e*j-r*z+i*P,y*b-p*w-m*v,c*w-f*b+l*v,o*O-s*z+a*M,n*z-e*O-i*M,p*x-_*b+m*d,h*b-c*x-l*d,s*P-o*T-u*M,e*T-n*P+r*M,_*v-p*g-y*d,c*g-h*v+f*d],1/S)},t.mat4LookAt=function(t,e,n,r){void 0===e&&(e=[0,0,0]),void 0===n&&(n=[0,1,0]),void 0===r&&(r=0);var i=k(F(t,e)),o=k(S(n,i));0!==r&&(o=A(E(o,Math.cos(r)),E(S(i,o),Math.sin(r))));var s=S(i,o);return[o[0],o[1],o[2],0,s[0],s[1],s[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],1]},t.mat4LookAtInverse=function(t,e,n,r){void 0===e&&(e=[0,0,0]),void 0===n&&(n=[0,1,0]),void 0===r&&(r=0);var i=k(F(t,e)),o=k(S(n,i));0!==r&&(o=A(E(o,Math.cos(r)),E(S(i,o),Math.sin(r))));var s=S(i,o);return[o[0],s[0],i[0],0,o[1],s[1],i[1],0,o[2],s[2],i[2],0,-R(o,t),-R(s,t),-R(i,t),1]},t.mat4Multiply=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(e.length<2)return e[0];var r=e.shift(),i=t.apply(void 0,u([],s(e))),o=r[0],a=r[1],c=r[2],h=r[3],f=r[4],l=r[5],p=r[6],_=r[7],y=r[8],m=r[9],d=r[10],v=r[11],b=r[12],g=r[13],x=r[14],w=r[15],M=i[0],P=i[1],z=i[2],T=i[3],O=i[4],j=i[5],E=i[6],S=i[7],A=i[8],k=i[9],F=i[10],R=i[11],q=i[12],I=i[13],D=i[14],Q=i[15];return[o*M+f*P+y*z+b*T,a*M+l*P+m*z+g*T,c*M+p*P+d*z+x*T,h*M+_*P+v*z+w*T,o*O+f*j+y*E+b*S,a*O+l*j+m*E+g*S,c*O+p*j+d*E+x*S,h*O+_*j+v*E+w*S,o*A+f*k+y*F+b*R,a*A+l*k+m*F+g*R,c*A+p*k+d*F+x*R,h*A+_*k+v*F+w*R,o*q+f*I+y*D+b*Q,a*q+l*I+m*D+g*Q,c*q+p*I+d*D+x*Q,h*q+_*I+v*D+w*Q]},t.mat4Perspective=function(t,e,n){void 0===t&&(t=45),void 0===e&&(e=.01),void 0===n&&(n=100);var r=1/Math.tan(t*Math.PI/360),i=n-e;return[r,0,0,0,0,r,0,0,0,0,-(n+e)/i,-1,0,0,-2*n*e/i,0]},t.mat4RotateX=function(t){var e=Math.cos(t),n=Math.sin(t);return[1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1]},t.mat4RotateY=function(t){var e=Math.cos(t),n=Math.sin(t);return[e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1]},t.mat4RotateZ=function(t){var e=Math.cos(t),n=Math.sin(t);return[e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1]},t.mat4Scale=function(t){return[t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,1]},t.mat4ScaleScalar=function(t){return[t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1]},t.mat4Translate=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1]},t.mat4Transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},t.matrix2d=function(t,e){for(var n=[],r=0;r<e;r++)for(var i=0;i<t;i++)n.push(i,r);return n},t.matrix3d=function(t,e,n){for(var r=[],i=0;i<n;i++)for(var o=0;o<e;o++)for(var s=0;s<t;s++)r.push(s,o,i);return r},t.mod=function(t,e){return t-Math.floor(t/e)*e},t.quatFromAxisAngle=function(t,e){var n=e/2,r=Math.sin(n);return[t[0]*r,t[1]*r,t[2]*r,Math.cos(n)]},t.quatFromMatrix4=O,t.quatInverse=q,t.quatMultiply=I,t.quatNormalize=function(t){var e=j(t);return 0===e?[0,0,0,1]:E(t,1/e)},t.range=function(t,e,n,r,i){return(t-e)*(i-r)/(n-e)+r},t.rawIdentityMatrix4=X,t.rawIdentityQuaternion=L,t.saturate=d,t.shuffleArray=function(t,e){for(var n=e||function(){return Math.random()},r=0;r<t.length-1;r++){var i=r+Math.floor(n()*(t.length-r)),o=t[i];t[i]=t[r],t[r]=o}return t},t.smootherstep=function(t,e,n){var r=v(t,e,n);return r*r*r*(r*(6*r-15)+10)},t.smootheststep=function(t,e,n){var r=v(t,e,n);return r*r*r*r*(r*(r*(-20*r+70)-84)+35)},t.smoothstep=function(t,e,n){var r=v(t,e,n);return r*r*(3-2*r)},t.triIndexToLineIndex=function(t){for(var e=[],n=0;n<t.length/3;n++){var r=3*n;e.push(t[r],t[r+1],t[r+1],t[r+2],t[r+2],t[r])}return e},t.vec3ApplyMatrix4=function(t,e){var n=D(u(u([],s(t)),[1]),e),r=n.pop();return E(n,1/r)},t.vec3ApplyQuaternion=function(t,e){var n=I(e,u(u([],s(t)),[0]),q(e));return n.pop(),n},t.vec3Cross=S,t.vec4ApplyMatrix4=D,t.vecAdd=A,t.vecDivide=function(t,e){return t.map((function(t,n){return t/e[n]}))},t.vecDot=R,t.vecLength=j,t.vecMultiply=function(t,e){return t.map((function(t,n){return t*e[n]}))},t.vecNormalize=k,t.vecScale=E,t.vecSub=F,Object.defineProperty(t,"__esModule",{value:!0})}));
